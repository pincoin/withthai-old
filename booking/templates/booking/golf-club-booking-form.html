{% extends 'conf/base.html' %}

{% load i18n static humanize %}

{% block main %}
    <main>
        <div class="section breadcrumbs">
            <div class="container">
                <nav class="breadcrumb has-bullet-separator" aria-label="breadcrumbs">
                    <ul>
                        <li>
                            <a href="{% url 'booking:golf-area-list' club.district.province.area.slug %}">
                                {% if LANGUAGE_CODE == 'th' %}
                                    {{ club.district.province.area.title_thai }}
                                {% elif LANGUAGE_CODE == 'ko' %}
                                    {{ club.district.province.area.title_korean }}
                                {% else %}
                                    {{ club.district.province.area.title_english }}
                                {% endif %}
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'booking:golf-province-list' club.district.province.slug %}">
                                {% if LANGUAGE_CODE == 'th' %}
                                    {{ club.district.province.title_thai }}
                                {% elif LANGUAGE_CODE == 'ko' %}
                                    {{ club.district.province.title_korean }}
                                {% else %}
                                    {{ club.district.province.title_english }}
                                {% endif %}
                            </a>
                        </li>
                        <li class="is-active">
                            <a href="#">
                                {% if LANGUAGE_CODE == 'th' %}
                                    {{ club.district.title_thai }}
                                {% elif LANGUAGE_CODE == 'ko' %}
                                    {{ club.district.title_korean }}
                                {% else %}
                                    {{ club.district.title_english }}
                                {% endif %}
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>

        <div class="section">
            <div class="container">
                <div class="columns is-multiline club-detail">
                    <div class="column is-12">
                        <div class="card">
                            <header class="card-header has-background-grey-lighter">
                                <h3 class="card-header-title is-size-3">
                                    {% if LANGUAGE_CODE == 'th' %}
                                        {{ club.title_thai }}
                                    {% elif LANGUAGE_CODE == 'ko' %}
                                        {{ club.title_korean }}
                                    {% else %}
                                        {{ club.title_english }}
                                    {% endif %}
                                </h3>
                                {% if request.user.is_superuser %}
                                    <a href="{% url 'admin:booking_club_change' club.id %}"
                                       class="button is-size-3 is-text">
                                        <span class="icon"><i class="fas fa-edit"></i></span>
                                    </a>
                                {% endif %}
                            </header>
                            <div class="card-content">
                                <div class="content">
                                    <div class="columns">
                                        <div class="column is-2">
                                            {% if club.thumbnail1 %}
                                                <img src="{{ club.thumbnail1.url }}" alt="">
                                            {% else %}
                                                <img src="//via.placeholder.com/640x320" alt="">
                                            {% endif %}
                                            <div class="is-hidden-touch" id="club-map-desktop"></div>
                                        </div>
                                        <div class="column is-5 club-detail-meta">
                                            <div class="columns is-hidden-touch">
                                                <div class="column is-3-desktop is-4-touch has-text-weight-bold">
                                                    {% trans 'Location' %}
                                                </div>
                                                <div class="column is-9-desktop is-8-touch">
                                                    {% if LANGUAGE_CODE == 'th' %}
                                                        {{ club.district.title_thai }}
                                                    {% elif LANGUAGE_CODE == 'ko' %}
                                                        {{ club.district.title_korean }}
                                                    {% else %}
                                                        {{ club.district.title_english }}
                                                    {% endif %} -
                                                    <a href="{% url 'booking:golf-province-list'  club.district.province.slug %}">
                                                        {% if LANGUAGE_CODE == 'th' %}
                                                            {{ club.district.province.title_thai }}
                                                        {% elif LANGUAGE_CODE == 'ko' %}
                                                            {{ club.district.province.title_korean }}
                                                        {% else %}
                                                            {{ club.district.province.title_english }}
                                                        {% endif %}
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="columns is-mobile">
                                                <div class="column is-3-desktop is-4-touch has-text-weight-bold">
                                                    {% trans 'Cart Fee' %}
                                                </div>
                                                <div class="column is-9-desktop is-8-touch">
                                                    <span>{{ club.cart_fee_selling_price|floatformat:0|intcomma }} {% trans 'THB' %}</span>
                                                    -
                                                    {% if club.cart_required == 0 %}
                                                        <span>
                                                            {% trans 'May require golf cart' %}
                                                        </span>
                                                    {% elif club.cart_required == 1 %}
                                                        <span class="has-text-danger">
                                                            {% trans 'Require golf cart' %}
                                                        </span>
                                                    {% else %}
                                                        <span class="has-text-danger">
{% blocktrans with golfers=club.cart_required %}Require golf cart with {{ golfers }} golfers or more{% endblocktrans %}
                                                        </span>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="columns is-mobile club-detail-meta-last-row-mobile">
                                                <div class="column is-3-desktop is-4-touch has-text-weight-bold">
                                                    {% trans 'Caddie Fee' %}
                                                </div>
                                                <div class="column is-9-desktop is-8-touch">
                                                    <span>{{ club.caddie_fee_selling_price|floatformat:0|intcomma }} {% trans 'THB' %}</span>
                                                </div>
                                            </div>

                                            {% if club.phone %}
                                                <div class="columns is-hidden-touch">
                                                    <div class="column is-3-desktop is-4-touch has-text-weight-bold">
                                                        {% trans 'Telephone' %}
                                                    </div>
                                                    <div class="column is-9-desktop is-8-touch">
                                                        <a href="tel:{{ club.phone|phone2numeric }}">
                                                            {{ club.phone }}
                                                        </a>
                                                    </div>
                                                </div>
                                            {% endif %}

                                            {% if club.address %}
                                                <div class="columns is-hidden-touch">
                                                    <div class="column is-3-desktop is-4-touch has-text-weight-bold">
                                                        {% trans 'Address' %}
                                                    </div>
                                                    <div class="column is-9-desktop is-8-touch">
                                                        {{ club.address }}
                                                    </div>
                                                </div>
                                            {% endif %}

                                            {% if club.website %}
                                                <div class="columns is-hidden-touch">
                                                    <div class="column is-3-desktop is-4-touch has-text-weight-bold">
                                                        {% trans 'Website' %}
                                                    </div>
                                                    <div class="column is-9-desktop is-8-touch">
                                                        <a href="{{ club.website }}" target="_blank">
                                                            {{ club.website }}
                                                        </a>
                                                    </div>
                                                </div>
                                            {% endif %}
                                        </div>
                                        <div class="divider is-vertical booking-divider is-hidden-touch"></div>
                                        <div class="column is-5">
                                            <form method="post">
                                                {% csrf_token %}
                                                <div class="field is-horizontal">
                                                    <div class="field-label is-normal">
                                                        <label class="label"
                                                               for="{{ form.round_date.id_for_label }}">{% trans 'Date/Time' %}</label>
                                                        <label class="label is-hidden"
                                                               for="{{ form.round_time.id_for_label }}">{% trans 'Date/Time' %}</label>
                                                    </div>
                                                    <div class="field-body">
                                                        <div class="field has-addons has-addons-fullwidth has-addons-right">
                                                            <div class="control">
                                                                <input class="input{% if form.round_date.errors %} is-danger{% endif %}"
                                                                       type="date"
                                                                       id="{{ form.round_date.id_for_label }}"
                                                                       name="{{ form.round_date.name }}"
                                                                       value="{{ form.round_date.value|default_if_none:"" }}"
                                                                       placeholder="YYYY-MM-DD">
                                                            </div>
                                                            <div class="control{% if form.round_date.errors and not form.round_time.errors %} time-input-margin{% endif %}">
                                                                <input class="input{% if form.round_time.errors %} is-danger{% endif %}"
                                                                       type="time"
                                                                       id="{{ form.round_time.id_for_label }}"
                                                                       name="{{ form.round_time.name }}"
                                                                       value="{{ form.round_time.value|default_if_none:"" }}"
                                                                       placeholder="HH:MM" step="60">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                {% if form.round_date.errors or form.round_time.errors %}
                                                    <div class="field is-horizontal">
                                                        <div class="field-label"></div>
                                                        <div class="field-body">
                                                            <article class="message is-danger booking-form-alert">
                                                                <div class="message-body">
                                                                    <ul>
                                                                        {% for error in form.round_date.errors %}
                                                                            <li>{{ error|escape }}</li>
                                                                        {% endfor %}
                                                                        {% for error in form.round_time.errors %}
                                                                            <li>{{ error|escape }}</li>
                                                                        {% endfor %}
                                                                    </ul>
                                                                </div>
                                                            </article>
                                                        </div>
                                                    </div>
                                                {% endif %}
                                                <div class="field is-horizontal">
                                                    <div class="field-label"></div>
                                                    <div class="field-body">
                                                        <article class="message is-info booking-form-alert">
                                                            <div class="message-body">
                                                                <ul>
                                                                    <li>{% trans 'Please, select your round date and time.' %}</li>
                                                                </ul>
                                                            </div>
                                                        </article>
                                                    </div>
                                                </div>
                                                <div class="field is-horizontal">
                                                    <div class="field-label is-normal">
                                                        <label class="label"
                                                               for="{{ form.pax.id_for_label }}">
                                                            {% trans 'Golfer #' %}
                                                        </label>
                                                    </div>
                                                    <div class="field-body">
                                                        <div class="field has-addons">
                                                            <div class="control is-expanded">
                                                                <div class="select is-fullwidth{% if form.pax.errors %} is-danger{% endif %}">
                                                                    <select id="{{ form.pax.id_for_label }}"
                                                                            name="{{ form.pax.name }}">
                                                                        {% for choice in form.pax.field.choices %}
                                                                            {% if forloop.counter0 <= club.max_pax %}
                                                                                <option value="{{ choice.0 }}"
                                                                                        {% if forloop.counter0 == 3 %}
                                                                                        selected
                                                                                        {% endif %}>
                                                                                    {{ choice.1 }}
                                                                                </option>
                                                                            {% endif %}
                                                                        {% endfor %}
                                                                    </select>
                                                                </div>
                                                            </div>
                                                            <div class="control">
                                                                <a class="button" id="plus-button">
                                                                    <i class="fas fa-plus fa-fw"></i>
                                                                </a>
                                                            </div>
                                                            <div class="control">
                                                                <a class="button" id="minus-button">
                                                                    <i class="fas fa-minus fa-fw"></i>
                                                                </a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                {% if form.pax.errors %}
                                                    <div class="field is-horizontal">
                                                        <div class="field-label"></div>
                                                        <div class="field-body">
                                                            <article class="message is-danger booking-form-alert">
                                                                <div class="message-body">
                                                                    <ul>
                                                                        {% for error in form.pax.errors %}
                                                                            <li>{{ error|escape }}</li>
                                                                        {% endfor %}
                                                                    </ul>
                                                                </div>
                                                            </article>
                                                        </div>
                                                    </div>
                                                {% endif %}
                                                <div class="field is-horizontal is-hidden" id="green-fee-block">
                                                    <div class="field-label is-normal">
                                                        <label class="label"
                                                               for="id_green_fee">{% trans 'Green Fee' %}</label>
                                                    </div>
                                                    <div class="field-body">
                                                        <div class="field has-addons">
                                                            <div class="control is-expanded">
                                                                <input type="text"
                                                                       class="input has-text-right has-text-weight-bold"
                                                                       readonly
                                                                       id="id_green_fee" value="0">
                                                            </div>
                                                            <div class="control">
                                                                <a class="button is-static">
                                                                    {% trans 'THB' %}
                                                                </a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="field is-horizontal is-hidden" id="total-block">
                                                    <div class="field-label is-normal">
                                                        <label class="label" for="id_total">{% trans 'Total' %}</label>
                                                    </div>
                                                    <div class="field-body">
                                                        <div class="field has-addons">
                                                            <div class="control is-expanded">
                                                                <input type="text"
                                                                       class="input has-text-right has-text-weight-bold"
                                                                       readonly
                                                                       id="id_total" value="0">
                                                            </div>
                                                            <div class="control">
                                                                <a class="button is-static">
                                                                    {% trans 'THB' %}
                                                                </a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="field is-horizontal is-hidden" id="invalid-round-date-time">
                                                    <div class="field-label"></div>
                                                    <div class="field-body">
                                                        <article class="message is-danger booking-form-alert">
                                                            <div class="message-body">
                                                                <ul>
                                                                    <li>
                                                                        {% trans 'You have chosen the unavailable round date/time.' %}
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                        </article>
                                                    </div>
                                                </div>
                                                <div class="field is-horizontal">
                                                    <div class="field-label"></div>
                                                    <div class="field-body">
                                                        <article class="message is-info booking-form-alert">
                                                            <div class="message-body">
                                                                <ul>
                                                                    {% for error in form.non_field_errors %}
                                                                        <li class="has-text-danger">
                                                                            {{ error }}
                                                                        </li>
                                                                    {% endfor %}
                                                                    <li>
                                                                        {% trans 'You have to pay caddie fee and cart fee at golf course.' %}
                                                                    </li>
                                                                    <li id="cart-message" class="is-hidden">
                                                                        {% trans 'You have to use a golf cart after payment at golf course.' %}
                                                                    </li>
                                                                    <li id="join-message" class="is-hidden">
                                                                        {% trans '1 or 2 players may have to join with others.' %}
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                        </article>
                                                    </div>
                                                </div>
                                                <div class="field is-horizontal">
                                                    <div class="field-label"></div>
                                                    <div class="field-body">
                                                        <div class="field">
                                                            <div class="control">
                                                                {% if user.is_authenticated %}
                                                                    <button type="submit"
                                                                            class="button is-fullwidth is-primary"
                                                                            id="submit-button" disabled>
                                                                        {% trans 'Booking Inquiry' %}
                                                                    </button>
                                                                {% else %}
                                                                    <a href="{% url 'account_login' %}"
                                                                       class="button is-fullwidth is-success">
                                                                        {% trans 'Booking Inquiry after Login' %}
                                                                    </a>
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="column is-12">
                        <div class="card">
                            <header class="card-header has-background-grey-lighter">
                                <h3 class="card-header-title is-size-3">
                                    {% trans 'Rate / Schedule' %}
                                </h3>
                            </header>
                            <div class="card-content">
                                <div class="content table-container">
                                    <table class="table rate-table">
                                        <thead>
                                        <tr>
                                            <th class="word-no-break is-hidden-touch">{% trans 'Period' %}</th>
                                            <th class="word-no-break">{% trans 'Type of day' %}</th>
                                            <th class="word-no-break is-hidden-touch">{% trans 'Time slot' %}</th>
                                            <th class="word-no-break">{% trans 'Time' %}</th>
                                            <th class="word-no-break">{% trans 'Rate' %}</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for rate in rates %}
                                            <tr>
                                                <td class="is-hidden-touch">
                                                    {{ rate.season_start }} ~ {{ rate.season_end }}
                                                </td>
                                                <td>
                                                    {{ rate.get_day_of_week_display }}
                                                </td>
                                                <td class="is-hidden-touch">
                                                    {{ rate.get_title_display }}
                                                </td>
                                                <td>
                                                    {{ rate.slot_start }} ~ {{ rate.slot_end }}
                                                </td>
                                                <td>
                                                    {{ rate.green_fee_selling_price|floatformat:0|intcomma }} {% trans 'THB' %}
                                                </td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="column is-12 is-hidden-desktop">
                        <div class="card">
                            <header class="card-header has-background-grey-lighter">
                                <h3 class="card-header-title is-size-3">
                                    {% trans 'Golf Club Information' %}
                                </h3>
                            </header>
                            <div class="card-content">
                                <div class="content">
                                    <div class="" id="club-map-touch"></div>
                                    <div class="club-detail-meta">
                                        <div class="columns is-mobile">
                                            <div class="column is-3-desktop is-4-touch has-text-weight-bold">
                                                {% trans 'Location' %}
                                            </div>
                                            <div class="column is-9-desktop is-8-touch">
                                                {% if LANGUAGE_CODE == 'th' %}
                                                    {{ club.district.title_thai }}
                                                {% elif LANGUAGE_CODE == 'ko' %}
                                                    {{ club.district.title_korean }}
                                                {% else %}
                                                    {{ club.district.title_english }}
                                                {% endif %} -
                                                <a href="{% url 'booking:golf-province-list'  club.district.province.slug %}">
                                                    {% if LANGUAGE_CODE == 'th' %}
                                                        {{ club.district.province.title_thai }}
                                                    {% elif LANGUAGE_CODE == 'ko' %}
                                                        {{ club.district.province.title_korean }}
                                                    {% else %}
                                                        {{ club.district.province.title_english }}
                                                    {% endif %}
                                                </a>
                                            </div>
                                        </div>

                                        {% if club.phone %}
                                            <div class="columns is-mobile">
                                                <div class="column is-3-desktop is-4-touch has-text-weight-bold">
                                                    {% trans 'Telephone' %}
                                                </div>
                                                <div class="column is-9-desktop is-8-touch">
                                                    <a href="tel:{{ club.phone|phone2numeric }}">
                                                        {{ club.phone }}
                                                    </a>
                                                </div>
                                            </div>
                                        {% endif %}

                                        {% if club.address %}
                                            <div class="columns is-mobile">
                                                <div class="column is-3-desktop is-4-touch has-text-weight-bold">
                                                    {% trans 'Address' %}
                                                </div>
                                                <div class="column is-9-desktop is-8-touch">
                                                    {{ club.address }}
                                                </div>
                                            </div>
                                        {% endif %}

                                        {% if club.website %}
                                            <div class="columns is-mobile">
                                                <div class="column is-3-desktop is-4-touch has-text-weight-bold">
                                                    {% trans 'Website' %}
                                                </div>
                                                <div class="column is-9-desktop is-8-touch">
                                                    <a href="{{ club.website }}" target="_blank">
                                                        {{ club.website }}
                                                    </a>
                                                </div>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {% include './_golf-club-booking-details.html' %}

                    <div class="column is-12">
                        <div class="card">
                            <header class="card-header has-background-grey-lighter">
                                <h3 class="card-header-title is-size-3">
                                    {% trans 'Cancel Policy' %}
                                </h3>
                            </header>
                            <div class="card-content">
                                <div class="content">
                                    <ul class="booking-detail-list">
                                        <li class="has-text-weight-bold">{% trans '8 days before round date' %}</li>
                                        <li>
                                            <ul>
                                                <li>
                                                    {% trans 'Total amount is refunded.' %}
                                                </li>
                                            </ul>
                                        </li>
                                        <li class="has-text-weight-bold">{% trans '7-4 days before round date' %}</li>
                                        <li>
                                            <ul>
                                                <li>
                                                    {% trans '50 percent of total amount is refunded.' %}
                                                </li>
                                            </ul>
                                        </li>
                                        <li class="has-text-weight-bold">{% trans 'Within 3 days of round date' %}</li>
                                        <li>
                                            <ul>
                                                <li>
                                                    {% trans 'Non-refundable' %}
                                                </li>
                                            </ul>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="column is-12">
                        <div class="card">
                            <header class="card-header has-background-grey-lighter">
                                <h3 class="card-header-title is-size-3">
                                    {% trans 'Rain Check' %}
                                </h3>
                            </header>
                            <div class="card-content">
                                <div class="content">
                                    <ul class="booking-detail-list">
                                        <li class="has-text-weight-bold">{% trans 'We obey the rules of golf clubs' %}</li>
                                        <li>
                                            <ul>
                                                <li>
                                                    {% trans 'No. Golf course has no rain check, no refund for any reason.' %}
                                                </li>
                                            </ul>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
{% endblock %}

{% block stylesheet %}
    {{ block.super }}
    <link type="text/css" rel="stylesheet" href="{% static 'booking/css/main.css' %}">
    <link type="text/css" rel="stylesheet" href="//cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
{% endblock %}

{% block javascript %}
    {{ block.super }}
    <script src="//cdn.jsdelivr.net/npm/flatpickr"></script>
    {% if LANGUAGE_CODE == 'ko' %}
        <script src="//npmcdn.com/flatpickr/dist/l10n/ko.js"></script>
    {% elif LANGUAGE_CODE == 'th' %}
        <script src="//npmcdn.com/flatpickr/dist/l10n/th.js"></script>
    {% endif %}
    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&callback=initMap">
    </script>
    <script src="{% static 'booking/js/main.js' %}"></script>
    <script>
        let club;
        let rates;
        let holidays;

        $(document).ready(function () {
            $.getJSON('{% url 'booking:golf-club-booking-json' club.slug %}', function (data) {
                club = data['club'];
                rates = data['rates'];
                holidays = data['holidays'];

                const today = new Date();
                const hour = today.toLocaleString('en-US', {
                    timeZone: 'Asia/Bangkok',
                    hour: 'numeric',
                    hour12: false
                });
                const day = today.toLocaleString('en-US', {
                    timeZone: 'Asia/Bangkok',
                    weekday: 'short',
                });

                {% if LANGUAGE_CODE == 'ko' %}
                    flatpickr.localize(flatpickr.l10ns.ko);
                {% elif LANGUAGE_CODE == 'th' %}
                    flatpickr.localize(flatpickr.l10ns.th);
                {% endif %}

                if (hour >= 16 && hour < 24) {
                    $('#id_round_date').flatpickr({
                        minDate: new Date().fp_incr(club['weekdays_min_in_advance'] + 1),
                        maxDate: new Date().fp_incr(club['weekdays_max_in_advance'] + 1)
                    });
                } else {
                    $('#id_round_date').flatpickr({
                        minDate: new Date().fp_incr(club['weekdays_min_in_advance']),
                        maxDate: new Date().fp_incr(club['weekdays_max_in_advance'])
                    });
                }

                $('#id_round_time').flatpickr({
                    enableTime: true,
                    noCalendar: true,
                    dateFormat: "H:i",
                    time_24hr: true,
                    minTime: "06:00",
                    maxTime: "19:30",
                    defaultDate: "06:00",
                    minuteIncrement: 10
                });

                $('#id_round_date, #id_round_time, #id_pax').on('change', function () {
                    const round_date = $('#id_round_date').val().split('-');
                    const round_time = $('#id_round_time').val().split(':');
                    const pax = $('#id_pax').val();

                    if (round_date && round_time && pax) {
                        const rdate = new Date(parseInt(round_date[0], 10),
                            parseInt(round_date[1], 10) - 1,
                            parseInt(round_date[2], 10));

                        const rtime = new Date(2020, 0, 1,
                            parseInt(round_time[0], 10),
                            parseInt(round_time[1], 10));

                        // 1. Notify join message

                        if (pax < 3) {
                            $('#join-message').removeClass('is-hidden');
                        } else {
                            $('#join-message').addClass('is-hidden');
                        }

                        // 2. Notify cart message
                        {% if club.cart_required >= 1 %}
                            if (pax >= {{ club.cart_required }}) {
                                $('#cart-message').removeClass('is-hidden');
                            } else {
                                $('#cart-message').addClass('is-hidden');
                            }
                        {% endif %}

                        // 3. Check whether holiday/weekends or not
                        let weekday = 0;

                        // 3-1. Weekends
                        if (rdate.getDay() === 6 || rdate.getDay() === 0) {
                            weekday = 1;
                        }

                        let out = false;

                        // 3-2. Holidays
                        for (i = 0; i < holidays.length; i++) {
                            const holiday = holidays[i].split('-');

                            if (rdate.getTime() === new Date(parseInt(holiday[0], 10),
                                parseInt(holiday[1], 10) - 1,
                                parseInt(holiday[2], 10)).getTime()) {
                                out = true;
                                weekday = 1;
                                break;
                            }

                            if (out) {
                                break;
                            }
                        }

                        let out1 = false;

                        // 4. Calculate rate
                        if (weekday === 0
                            || (weekday === 1
                                && rdate.getTime() - today.getTime() < club['weekend_max_in_advance'] * 24 * 60 * 60 * 1000)
                            && day.toUpperCase() !== 'SAT'
                            && day.toUpperCase() !== 'SUN') {

                            for (i = 0; i < rates.length; i++) {
                                if (rates[i]['weekday'] === weekday) {
                                    // check whether round date is within season
                                    const season_start = rates[i]['season_start'].split('-');
                                    const season_end = rates[i]['season_end'].split('-');

                                    if (rdate.getTime() >= new Date(parseInt(season_start[0], 10),
                                        parseInt(season_start[1], 10) - 1,
                                        parseInt(season_start[2], 10)).getTime()
                                        && rdate.getTime() <= new Date(parseInt(season_end[0], 10),
                                            parseInt(season_end[1], 10) - 1,
                                            parseInt(season_end[2], 10)).getTime()) {
                                        // check whether round time is within available slot time
                                        const slot_start = rates[i]['slot_start'].split(':');
                                        const slot_end = rates[i]['slot_end'].split(':');

                                        if (rtime.getTime() >= new Date(2020, 0, 1,
                                            parseInt(slot_start[0], 10), parseInt(slot_start[1], 10))
                                            && rtime.getTime() <= new Date(2020, 0, 1,
                                                parseInt(slot_end[0], 10), parseInt(slot_end[1], 10))) {
                                            $('#invalid-round-date-time').addClass('is-hidden');

                                            $('#green-fee-block').removeClass('is-hidden');
                                            $('#id_green_fee').val(Number(rates[i]['green_fee']).toLocaleString('en'));

                                            $('#total-block').removeClass('is-hidden');
                                            $('#id_total').val(Number(rates[i]['green_fee'] * pax).toLocaleString('en'));

                                            $('#submit-button').removeAttr('disabled');

                                            out1 = true;
                                            break;
                                        }
                                    }
                                }
                                if (out1) {
                                    break;
                                }
                            }
                        }

                        if (!out1) {
                            $('#invalid-round-date-time').removeClass('is-hidden');
                            $('#green-fee-block').addClass('is-hidden');
                            $('#total-block').addClass('is-hidden');
                            $('#submit-button').prop('disabled', true);
                        }
                    }
                });

                $('#plus-button').on('click', function () {
                    const pax = $('#id_pax');

                    if (pax.val() <= {{ club.max_pax }}) {
                        let n = parseInt(pax.val()) + 1;
                        pax.val(n);
                        $('#id_total').val(Number(rates[i]['green_fee'] * n).toLocaleString('en'));

                        if (n < 3) {
                            $('#join-message').removeClass('is-hidden');
                        } else {
                            $('#join-message').addClass('is-hidden');
                        }

                        {% if club.cart_required >= 1 %}
                            if (n >= {{ club.cart_required }}) {
                                $('#cart-message').removeClass('is-hidden');
                            } else {
                                $('#cart-message').addClass('is-hidden');
                            }
                        {% endif %}
                    }
                });

                $('#minus-button').on('click', function () {
                    const pax = $('#id_pax');

                    if (pax.val() > 1) {
                        let n = parseInt(pax.val()) - 1;
                        pax.val(n);
                        $('#id_total').val(Number(rates[i]['green_fee'] * n).toLocaleString('en'));

                        if (n < 3) {
                            $('#join-message').removeClass('is-hidden');
                        } else {
                            $('#join-message').addClass('is-hidden');
                        }

                        {% if club.cart_required >= 1 %}
                            if (n >= {{ club.cart_required }}) {
                                $('#cart-message').removeClass('is-hidden');
                            } else {
                                $('#cart-message').addClass('is-hidden');
                            }
                        {% endif %}
                    }
                });
            });
        });
    </script>

    <script>
        // Initialize and add the map
        function initMap() {
            // The location of Club
            var location = {lat: {{ club.latitude }}, lng: {{ club.longitude }}};

            // The map, centered at Club
            let map;

            if ($(window).width() >= 1024) {
                map = new google.maps.Map(document.getElementById('club-map-desktop'), {zoom: 12, center: location});
            } else {
                map = new google.maps.Map(document.getElementById('club-map-touch'), {zoom: 12, center: location});
            }

            // The marker, positioned at Club
            var marker = new google.maps.Marker({position: location, map: map});
        }
    </script>
{% endblock %}
